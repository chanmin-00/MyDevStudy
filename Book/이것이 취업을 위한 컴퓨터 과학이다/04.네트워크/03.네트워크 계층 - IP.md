# IP의 목적과 특징

IP(Internet Protocol)는 네트워크 계층에서 데이터를 전달하는 기본 프로토콜이다. 그 목적은 크게 다음 두 가지로 나뉜다.

1. `주소 지정`
    - 네트워크 간 통신에서 호스트(컴퓨터, 라우터 등) 를 특정한다.
    - 각 호스트에는 고유한 IP 주소가 부여된다.
2. `단편화(Fragmentation)`
    - 데이터를 여러 IP 패킷으로 쪼개어 전송할 수 있도록 한다.
    - 전송 경로의 MTU보다 큰 데이터를 나누는 작업을 의미한다.

또한, IP는 다음과 같은 특징이 있다.

- 신뢰할 수 없는 통신(Unreliable) : 패킷이 제대로 도착했는지 확인하지 않음
- 비연결형 통신(Connectionless) : 수신지와의 연결을 사전에 설정하지 않고 일방적으로 전송

## 주소 지정과 단편화

### 주소 지정

- **I**P 주소는 32비트(4바이트)이며, 8비트씩 나눠 4개의 10진수(0~255) 로 구성된다.
- 표기 예: `192.168.1.1`
- 각 8비트를 옥텟(Octet) 이라고 부르며, 점(.)으로 구분된다.

### IP 패킷 헤더의 주소 필드

- 송신지 IP 주소
- 수신지 IP 주소

이 필드를 통해 송수신지를 명확히 식별할 수 있다.

![image](https://github.com/user-attachments/assets/1d8242ec-202d-4f43-ad28-9e2dd70e303c)


### 라우터와 라우팅

- 패킷을 올바르게 전달하기 위해서는 MAC 주소와 IP 주소 모두 필요
- 그러나 실제 네트워크 간 통신에서는 IP 주소를 우선적으로 사용한다.

`라우터(Router)`

- 서로 다른 네트워크를 연결하며, IP 주소를 바탕으로 패킷을 전달하는 장비
- IP 패킷의 최적 경로를 결정해 전송하는 과정을 라우팅(Routing) 이라고 함
- 공유기도 라우터의 일종

![image](https://github.com/user-attachments/assets/3d1899b3-cd88-4147-aee6-905c55b768c4)


### 단편화와 MTU

- `MTU(Maximum Transmission Unit)` : 한 번에 전송 가능한 데이터의 최대 크기 (보통 1500바이트)
- MTU보다 큰 IP 패킷은 여러 개로 쪼개져 전송되고, 수신지에서 다시 조합됨

**단편화 시 사용되는 IP 헤더 필드**

| 필드명 | 설명 |
| --- | --- |
| `식별자(Identification)` | 동일한 데이터에서 파생된 패킷을 식별하는 ID |
| `플래그(Flags)` | 3비트: DF(단편화 금지), MF(뒤에 더 있음) |
| `단편화 오프셋(Fragment Offset)` | 원본 데이터에서 해당 조각이 차지하는 위치 |

![image](https://github.com/user-attachments/assets/3c7b1e4f-cd1f-49ce-8760-7a53fe14a403)


## 신뢰할 수 없는 통신과 비연결형 통신

### 신뢰할 수 없는 프로토콜

- IP는 수신 여부를 확인하거나 재전송을 보장하지 않음
- 이런 특성 때문에 최선형 전달(best-effort delivery) 이라고 부른다

### 비연결형 프로토콜

- IP는 TCP처럼 송수신 준비 과정을 거치지 않고 일방적으로 전송함
- 연결 수립 없이, 상대 호스트의 준비 여부와 무관하게 전송. TCP는 반대로 3-way handshake를 통해 연결을 먼저 설정함

## IP 단편화 피하기 - 경로 MTU 발견

### 단편화의 문제점

- 단편화가 자주 발생하면
    - 헤더가 많아져 트래픽 증가
    - 대역폭 낭비
    - 라우터/호스트의 부하 증가
- 때문에 현대 네트워크에서는 단편화를 지양하는 경향이 있다.

### 해결 방법: Path MTU Discovery

- `Path MTU Discovery` : 출발지부터 목적지까지 가장 작은 MTU 값을 찾아 그 이하의 크기로 패킷 전송.
- IP 단편화를 방지하여 네트워크 효율을 높임.

### 예시

- 송신지/수신지는 MTU 1500
- 중간 장비의 MTU가 1000이라면?
    - 최적 경로의 MTU는 1000, 이를 기준으로 1000바이트 이하의 패킷을 전송하면 단편화 없이 전달 가능

# IP 주소의 구조

IP 주소는 두 부분으로 구성된다.

### 네트워크 주소 (Network Address)

- 네트워크 ID, 네트워크 식별자라고도 하며, 호스트가 속한 네트워크를 구분하는 데 사용된다.

### 호스트 주소 (Host Address)

- 호스트 ID, 호스트 식별자라고도 하며, 해당 네트워크 내에서 개별 호스트를 식별하는 데 사용된다.

네트워크와 호스트 부분의 크기는 상황에 따라 다를 수 있다

- 예) 네트워크 주소가 짧을수록 한 네트워크 내 많은 호스트에게 IP를 할당 가능하다.

![image](https://github.com/user-attachments/assets/2f5a6203-75fe-4df5-9273-1600a060c3c7)


## 클래스풀 주소 체계

### 개요

- IP 주소 낭비를 줄이고, 네트워크 크기별 분류를 위해 등장한 구조이다.
- 클래스(Class): 네트워크 크기에 따라 A, B, C, D, E로 구분.
    - 실질적으로 사용되는 클래스는 A, B, C
    - D, E는 멀티캐스트 및 예약용으로 사용
- 클래스풀 주소 체계 : 클래스를 바탕으로 IP 주소를 관리하는 체계

### 클래스별 구조

| 클래스 | 시작 비트 | 네트워크/호스트 옥텟 | 표현 범위 | 특징 |
| --- | --- | --- | --- | --- |
| A | 0 | 1 옥텟 / 3 옥텟 | 0.0.0.0 ~ 127.255.255.255 | 많은 호스트 지원 |
| B | 10 | 2 옥텟 / 2 옥텟 | 128.0.0.0 ~ 191.255.255.255 | 중간 규모 네트워크 |
| C | 110 | 3 옥텟 / 1 옥텟 | 192.0.0.0 ~ 223.255.255.255 | 소규모 네트워크 |
- 첫 옥텟의 주소만 보고도 A, B, C 클래스 중 어떤 클래스에 속한  IP 주소인지 알수 있음

### 특수 주소

- 네트워크 주소: 호스트 부분이 모두 0 → 해당 네트워크 자체
- 브로드캐스트 주소: 호스트 부분이 모두 1 → 네트워크 내 모든 호스트 대상
- 루프백 주소: `127.0.0.1` → 자기 자신을 가리키는 IP
- 0.0.0.0: 아직 IP를 할당받지 않은 상태에서 임시로 사용

![image](https://github.com/user-attachments/assets/5c8dbc01-4d4f-433f-9a04-98db76d5ca69)


## 클래스리스 주소 체계와 서브넷 마스크

### 클래스리스 개념

- 클래스 기반의 고정 구조는 유연성 부족 및 IP 낭비를 초래
- 이를 해결하기 위해 클래스를 사용하지 않는 구조(CIDR) 도입

### 서브넷 마스크란?

- 네트워크와 호스트를 구분하는 수단으로 서브넷 마스크를 이용한다.
- IP 주소에서 네트워크 영역은 1, 호스트 영역은 0으로 표기하는 비트 마스크
- 서브넷 마스크는 IP 주소와 AND 연산을 통해 네트워크 주소를 식별 가능하게 한다.

### 기본 서브넷 마스크 (클래스풀 기준)

| 클래스 | 서브넷 마스크 |
| --- | --- |
| A | 255.0.0.0 |
| B | 255.255.0.0 |
| C | 255.255.255.0 |

### 서브네팅(Subnetting)

- 서브넷 마스크를 이용해 네트워크를 더 세분화.
- 하나의 네트워크를 `여러 개의 서브 네트워크(서브넷)`로 나누어 IP 낭비 방지할 수 있다.

## CIDR 표기법 (Classless Inter-Domain Routing)

- 서브넷 마스크를 IP 주소와 결합해 하나의 문자열로 표현.
- `/` 뒤에 나오는 숫자는 서브넷 마스크 상의 1의 개수를 의미.

### 예시

```
192.168.20.3/30
→ 서브넷 마스크: 255.255.255.252 (1이 30개)
```

- 이 표기법을 통해 더 유연한 네트워크 설계와 IP 할당이 가능해짐.

# 공인 IP 주소와 사설 IP 주소

### 공인 IP 주소 (Public IP)

- 전 세계적으로 고유한 IP 주소.
- 인터넷 통신에서 사용되며, 외부에서 접근 가능한 IP.
- 사용자가 검색 사이트에서 확인하는 IP 주소는 대부분 공인 IP 주소.
- `ISP(인터넷 서비스 제공자)`나 `공인 기관(IANA, KISA 등)`을 통해 할당받음.

### 사설 IP 주소 (Private IP)

- 사설 네트워크(내부망) 전용 IP 주소.
- 인터넷에서 직접 사용되지 않으며, 라우터가 NAT(Network Address Translation) 기능을 통해 외부 통신을 지원.
- 대부분의 가정, 회사 LAN에서 사용되며, 공유기를 기준으로 연결된 네트워크가 사설 네트워크임.

### 사설 IP 주소 공간 (RFC 1918)

- 사설 IP주소로 사용하도록 특별히 예약된 IP 주소 공간 존재한다.

| 클래스 | IP 대역 | 사용 예 |
| --- | --- | --- |
| A | 10.0.0.0 ~ 10.255.255.255 | 대형 사설망 |
| B | 172.16.0.0 ~ 172.31.255.255 | 중형 사설망 |
| C | 192.168.0.0 ~ 192.168.255.255 | 가정용 네트워크 |

> 사설 IP 주소는 네트워크 내부에서만 유효하며, 그렇기 때문에 다른 네트워크 상의 사설 IP와 중복 사용 가능하다.
> 

# IP 주소의 할당

IP 주소는 호스트에 정적 또는 동적으로 할당할 수 있다.

## 정적 할당 (Static IP)

- IP 주소를 사용자가 수동으로 직접 입력하여 설정하는 방식.
- 정적 할당을 통해 할당된 IP 주소를 정적 IP 주소라 하며, 설정한 주소는 변하지 않는다.

### 설정 시 입력 정보

- IP 주소
- 서브넷 마스크
- 게이트웨이 주소 (기본 게이트웨이)
- DNS 서버 주소

> 운영체제에 따라 입력 방식은 다르지만, 필요한 정보는 대부분 동일하다.
> 

### 주요 개념

- `기본 게이트웨이 (Default Gateway)`
    - 내부 네트워크에서 외부로 나가기 위한 출구 역할
    - 일반적으로 라우터의 IP 주소를 사용
- `DNS 서버 주소`
    - 도메인 네임 → IP 주소 변환을 위한 서버.
    - 사용자는 기억하기 쉬운 도메인으로 접근하고, DNS가 IP 주소를 알려준다.

## 동적 할당 (Dynamic IP)

- DHCP 프로토콜을 통해 IP 주소를 자동으로 부여받는 방식.
- 주로 가정용, 기업용 네트워크에서 라우터가 DHCP 서버 역할 수행.
- DHCP 서버는 호스트에 할당 가능한 IP 주소 목록을 관리하다가, IP 주소할당 요청을 받았을 때 IP 주소를 할당해주는 호스트 역할을 한다.

### IP 주소 임대 과정

1. 호스트가 IP 주소 요청 메시지를 보냄
2. DHCP 서버가 할당 가능한 IP 목록 중 하나를 선택하여 임시로 할당
3. 할당된 IP는 임대 기간을 가짐 (예: 몇 시간 ~ 몇 일)
4. 사용하지 않거나 임대 시간이 만료되면 IP는 회수됨
5. 재접속 시 다른 IP 주소가 할당될 수 있음

### 임대 갱신

- IP 임대 기간 중 두 차례 자동 갱신 시도
- 두 번 모두 실패하면 IP 주소는 반납됨

# IP 전송 특징의 보완: ICMP

### IP의 전송 한계

- IP는 비연결형, 신뢰할 수 없는 프로토콜
- 빠른 전송 성능을 목표로 하기 때문에 패킷 유실, 순서 오류, 연결 관리 등을 수행하지 않음
- 연결형 전송(예: TCP)은 오류 제어와 연결 관리를 위한 추가 리소스(시간, 대역폭 등)가 필요하여 성능 저하 가능

### IP 전송의 보완 방식

1. 상위 계층의 연결형 프로토콜 사용 → 예: TCP
2. ICMP(Internet Control Message Protocol) 사용

### ICMP란?

- IP 패킷 전송 결과에 대한 `피드백 메시지(ICMP 메시지)`를 주고받기 위한 프로토콜
- IP 전송의 상태를 확인하거나 문제 발생 시 원인을 추적하는 데 사용
- IP의 신뢰성을 완전히 보장하지는 않지만, 전송 실패 원인 등을 파악하는 데 도움
    
    ![image](https://github.com/user-attachments/assets/4f6665d5-ab04-4db5-8540-70216450bc66)

    

### ICMP 메시지의 주요 유형

| 유형 | 설명 |
| --- | --- |
| 목적지 도달 불가 | 라우터가 해당 목적지로 가는 경로를 모를 때 전송 |
| 단편화 필요, DF 설정됨 | MTU 초과 패킷을 받았지만, DF(Don’t Fragment) 비트가 설정되어 있어 단편화 불가 시 전송 |
| 시간 초과(Time Exceeded) | 패킷의 TTL(Time To Live)이 0이 되어 폐기될 때 전송 |

> TTL은 패킷이 라우터를 지날 때마다 1씩 감소하며, 0이 되면 폐기됨. 이는 무한 루프를 방지하기 위한 장치.
> 

![image](https://github.com/user-attachments/assets/ddad453a-ad7f-4740-a5e3-2a93bda23127)


### ICMP 기반 도구

- `ping` : 대상 호스트에 에코 요청을 보내 응답 확인, 연결 상태 확인
- `traceroute` : 라우터 경로 추적, TTL 값을 1씩 늘려가며 경로 파악

# IP 주소와 MAC 주소의 대응

- IP 통신 과정에서는 IP 주소와 MAC 주소를 모두 사용해야 한다.
- IP 주소는 논리 주소로 통신 대상 호스트를 식별하고, MAC 주소는 물리 주소로 실제 장비를 구분한다.

### 문제 상황

- IP 주소는 알지만 MAC 주소를 모를 경우, 어떻게 통신할까? → 이때 사용되는 프로토콜이 `ARP(Address Resolution Protocol)` 이다.

### ARP 동작 과정

1. 송신 호스트는 대상 호스트의 IP 주소는 알지만 MAC 주소를 모름
2. `ARP 요청 메시지(브로드캐스트)` 전송
    
    → ‘이 IP 주소를 가진 장비의 MAC 주소는 무엇입니까?’
    
3. 같은 네트워크 내의 모든 호스트가 요청 수신
4. 해당 IP 주소를 가진 호스트만 `ARP 응답 메시지(유니캐스트)`로 자신의 MAC 주소를 회신
5. 송신 호스트는 응답으로 받은 `<IP, MAC>` 쌍을 기억함

### ARP 테이블

- 송신 호스트는 ARP 요청·응답 과정을 반복하지 않기 위해 ARP 테이블을 유지
- <IP 주소, MAC 주소>의 쌍으로 구성
- 일정 시간이 지나면 항목이 만료되어 자동 삭제됨 (임의 삭제도 가능)

> 명령어 예: arp -a 또는 arp -af 를 통해 확인 가능
>
