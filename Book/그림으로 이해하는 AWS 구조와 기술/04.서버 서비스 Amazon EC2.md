# Amazon EC2란

- EC2는 AWS에서 가장 대표적인 서비스로, 컴퓨팅 용량을 제공하는 가상 서버
- 클라우드 환경에서 클릭 몇 번으로 쉽게 서버를 만들 수 있으며, OS와 소프트웨어가 구성된 템플릿(AMI)을 통해 다양한 서버 환경을 구축 가능
- 단, 매니지드 서비스가 아니기 때문에 사용자가 직접 OS 설치, 보안 구성, 네트워크 설정 등을 해야 한다.

## Amazon EC2란

- Amazon EC2는 클라우드 기반에서 서버를 직접 구성할 수 있는 컴퓨팅 서비스이다.
- 서버 기계를 임대하는 개념이 아니라, 사용자가 원하는 OS 조합 등을 선택하여 서버를 클라우드 위에 생성하는 개념

> EC2는 매니지드 서비스가 아니며, 시스템 운영 및 업데이트를 직접 수행해야 한다.
> 

## 클릭 한 번으로 최적의 서버를 만들 수 있다

- 물리 서버 구축과 달리 EC2는 콘솔에서 클릭 한 번으로 서버 생성이 가능
- 미리 준비된 인스턴스 유형과 AMI를 선택하면 되며, 초기 투자 비용도 적고, 설정 변경도 유연하다.

설계적인 관점이 중요하며, 필요에 따라 조합을 구성해야 한다.

## 바로 생성할 수 있고 바로 삭제할 수 있다

- EC2는 즉시 생성, 삭제가 가능하여 테스트나 임시 사용에 적합하다.
- 장애 발생 시 복제하여 복구, 트래픽 증가 시 스케일 아웃, 사용량 감소 시 스케일 다운이 쉽다.

> 불확실성이 큰 상황에서 유용하며, 초기 사양 확정이 어려울 때 적합
> 

## 인스턴스 유형 및 OS를 선택한다

- EC2 인스턴스는 AMI(소프트웨어 구성 템플릿)와 인스턴스 유형(CPU, 메모리 등)을 선택해 구성한다.
- 직접 소프트웨어를 설치할 수도 있고, 미리 설치된 구성을 사용할 수도 있다.

# EC2의 사용 절차: 가상 서버를 사용하기까지

EC2는 AWS 관리 콘솔의 **대시보드에서 인스턴스를 생성**하는 것으로 시작한다.

이후 SSH로 원격 접속하여 소프트웨어 설치, 설정을 수행한다.

## EC2 운영

- 기존의 물리 서버는 현장에서 하드웨어 설치가 필요하지만, EC2는 콘솔에서 모든 구성이 가능하다.
- SSH를 통해 원격 접속하여 운영하며, 이는 클라우드/온프레미스 모두 동일

## EC2 서비스의 기능

자주 쓰이는 EC2 관련 개념

| 항목 | 설명 |
| --- | --- |
| 인스턴스 | 생성된 가상 서버 |
| AMI | 서버 구성 템플릿 |
| 키 페어 | SSH 접속 시 인증 수단 |
| EBS | 인스턴스 저장소 |
| 보안 그룹 | 가상 방화벽 |
| Elastic IP | 고정 IP 주소 |

## EC2의 사용 절차

1. 로그인 및 대시보드 열기
2. 인스턴스 생성
    - AMI, 인스턴스 유형, 네트워크, 키 페어 등 설정
3. SSH 접속
4. 필요한 소프트웨어 설치 및 설정

## 인스턴스 설정 항목

EC2 인스턴스를 생성할 때는 다음과 같은 항목을 설정한다:

- `AMI`: OS 및 소프트웨어 구성
- `인스턴스 유형`: CPU/메모리 사양
- `리전/서브넷`: 배치 위치와 네트워크 범위
- `스토리지`: EBS 크기 및 유형
- `IAM 역할`, `보안 그룹`, `태그` 등

# 인스턴스 생성과 요금: 가상 서버 생성 예시

요금은 인스턴스 사양, 저장소, 네트워크 사용량에 따라 달라지며, 설정이 복잡하므로 계산 도구 활용이 권장된다.

## 인스턴스 생성 예시

간단한 서버 설정 예시는 다음과 같다

| 항목 | 예시 설정 |
| --- | --- |
| AMI | Amazon Linux2 |
| 인스턴스 유형 | t2.micro |
| 리전 | 서울 |
| 스토리지 | 8GB SSD |
| 보안 그룹 | SSH, HTTP, HTTPS 허용 |

## 인스턴스의 요금

EC2 비용 구성

```

요금 = 인스턴스 사용료 + EBS 요금 + 통신 요금 + 기타 옵션
```

- `인스턴스 요금`: 가동 시간 기준 과금
- `EBS 요금`: 용량 및 성능 기준
- `통신 요금`: 아웃바운드(외부로 나가는 트래픽)에 과금
- `기타 요금`: Elastic IP 등 추가 서비스

### AWS 가입 후 1년간 특전

- 750시간/월 t2.micro 무료
- EBS 30GB, 데이터 15GB까지 무료 제공

### Column: EC2가 적합하지 않은 경우

- 단일 서버 기반의 고정적인 시스템에는 EC2보다 다른 서비스가 더 적합
- T2/T3 사용 제약 존재
- “코드 없이 구축하는” 환경에는 부적절하며, 매달 운영비를 신경 써야 함

# AMI: OS 및 소프트웨어가 설치된 디스크 이미지

AMI를 사용하면 동일한 인스턴스를 대량으로 쉽게 생성할 수 있다.

## AMI와 인스턴스

`AMI(Amazon Machine Image)` : 소프트웨어 구성을 기록한 템플릿이다. 인스턴스(가상 서버)를 생성하기 위한 금형과 같은 역할을 한다.

- AMI를 사용하면 같은 설정의 서버를 대량으로 생성할 수 있다. 특히 공식 AMI를 활용하면 손쉽게 인스턴스를 생성 가능하다.
- 예를 들어 같은 서버를 여러 대 구축할 경우 `서버 OS`, `아파치`, `소프트웨어 설치 및 설정`을 반복하는 대신 AMI로 단 몇 분 만에 동일한 서버를 만들 수 있다.

## cf) AMI와 OS

- AMI는 서버 디스크에 설치된 내용 전체가 포함되어 있으며, 인스턴스 생성 시 모두 복사된다. 따라서 AMI에는 반드시 OS가 설치되어 있어야 한다.
- 일부 소프트웨어만 선택하거나 일부 데이터만 쓰기 전용으로 설정하는 것은 불가능하다.

## 제공되는 OS 이미지

AMI는 AWS 공식 이미지뿐만 아니라 커뮤니티판, 기업이 생성한 이미지도 제공된다. 대부분의 이미지가 즉시 사용 가능한 상태로 설정되어 있으며 새로운 버전 제공도 빠르다.

- 일부 AMI는 이용 시 별도 요금이 발생할 수 있다.

| AMI 이름 | 설명 |
| --- | --- |
| Amazon Linux | 아마존이 제공하는 레드햇 기반 리눅스 |
| CentOS | 센트OS 리눅스 |
| Red Hat Enterprise Linux | 레드햇 리눅스 |
| Debian GNU/Linux | 데비안 리눅스 |
| Ubuntu Server | 우분투 리눅스 |
| SUSE Linux Enterprise Server | 수세 리눅스 |
| Microsoft Windows Server | 윈도우 서버 |
| LAMP Certified by Bitnami | 리눅스 + 아파치 + MySQL + PHP 서버 |
| Tomcat Certified by Bitnami | 자바 서블릿용 톰캣 서버 |
| WordPress powered by AMIMOTO | 블로그 시스템 워드프레스 |
| Movable Type | 블로그 시스템 무버블 타입 |
| NGINX Open Source Certified by Bitnami | 웹 서버 Nginx |
| Redmine Certified by Bitnami | 프로젝트 관리 도구 레드마인 |
| NextCloud Powered by IVCISA | 파일 공유 도구 넥스트클라우드 |
| SFTP Gateway | 암호화 FTP 서버 |

## AMI 요금

AMI는 무료와 유료가 있다.

- 예: `Microsoft Windows Server`처럼 원래 유료 소프트웨어는 AMI도 유료
- 개인이 생성한 AMI는 이미지 용량에 따라 요금 부과

## AMI를 직접 만들어 보자

AMI는 개인이 직접 생성할 수 있다. 동일한 구성의 서버 복제나 서버 백업용으로 유용하다.

- 생성된 AMI는 마켓플레이스에 배포 가능

<img width="521" alt="image" src="https://github.com/user-attachments/assets/1b852a71-3954-4732-a666-bc1cfd33cd43" />


### cf) 마켓플레이스

AWS에서 AMI를 배포할 수 있는 공간이다.

- 무료/유료 관계없이 사용 가능
- 수천 개의 AMI가 등록되어 있음
- 개인, 기업, 커뮤니티 등 다양한 제작자가 참여

단, 배포된 AMI가 반드시 안전하다는 보장은 없으므로 제공자를 반드시 확인하고 사용하는 것이 중요하다.

# 인스턴스 유형 : 용도에 맞게 머신을 선택하자

## 인스턴스 유형이란?

- 인스턴스 유형이란 머신의 용도에 따라 조합된 사양(CPU, 메모리, 스토리지, 네트워크)을 의미한다.
- 일반 PC처럼 가격과 성능의 조합을 선택하는 개념이며 용도에 따라 다양한 유형이 존재한다.

## 인스턴스 유형과 크기

인스턴스는 `유형` + `크기` 조합으로 성능이 결정된다.

- 예시: `t2.micro`
- T2 유형은 성능을 올려주는 버스트 기능이 있는 범용 인스턴스로, 다음과 같은 크기 옵션을 제공한다.
    - `nano`, `micro`, `small`, `medium`, `large`, `xlarge`, `2xlarge`, `4xlarge`
- 인스턴스의 단가는 유형, 크기 조합에 사용 시간을 곱하여 산정된다.

### 주요 인스턴스 유형

| 용도 | 인스턴스 유형 | 설명 |
| --- | --- | --- |
| 범용 | T2, T3, M5, M4 | 일반적 서버용, 일정 부하 처리, 버스트 기능 있음 |
| 컴퓨팅 최적화 | C5, C4 | 연산 중심 처리에 적합 |
| 메모리 최적화 | X1e, X1, R4 | 빠른 메모리 액세스, 대용량 메모리 탑재 |
| 가속화된 컴퓨팅 | P3, P2, G3, F1 | GPU 포함, 머신러닝/그래픽 처리용 |
| 스토리지 최적화 | H1, I3, D2 | 디스크 I/O 성능 최적화, I3는 SSD 기반 |


# Amazon EBS: Amazon EC2의 스토리지 볼륨

## EBS란

- Amazon EBS (Elastic Block Store)는 영구적인 블록 스토리지 볼륨으로, EC2 인스턴스와 함께 사용할 수 있는 저장소이다.
- 스토리지는 데이터를 기록하는 장소로, 대표적인 저장 장치는 `HDD(하드 디스크 드라이브)`와 `SSD(솔리드 스테이트 드라이브)`가 있다.
- 블록 스토리지는 데이터를 바이트 블록 단위로 디스크에 저장하는 방식이다.
    - 참고: 같은 AWS 서비스인 Amazon S3는 오브젝트 스토리지 방식을 사용

> HDD vs SSD
> 
> - HDD: 대용량 저장에 적합, 가격이 저렴하지만 성능이 낮음
> - SSD: IOPS(IOPS: 초당 입출력 횟수)가 높아 고성능 작업에 적합, 가격은 다소 비쌈
> - 사용 목적에 따라 고성능 SSD, 저비용 HDD를 선택

<img width="502" alt="image" src="https://github.com/user-attachments/assets/e13521f4-5fd3-41f9-9b49-acf7ec217c51" />


## EBS의 볼륨 유형

EBS는 HDD, SSD 등 다양한 유형의 볼륨을 제공하며, IOPS 성능에 따라 최적화된 유형을 선택할 수 있다. 성능과 요금을 비교해 선택 가능하다.

## EBS의 기능과 요금

- `탄력적 볼륨`: 볼륨 크기를 쉽게 조정 가능
- `스냅샷`: 특정 시점의 데이터를 저장
- `데이터 라이프 사이클 매니저`: 일정에 따라 스냅샷을 자동 생성 및 삭제
- `최적화 인스턴스`: 읽기/쓰기 고속화 최적화 인스턴스 사용
- `암호화`: KMS(Key Management Service)를 통해 데이터/스냅샷 암호화 가능

### 요금

- 산정 방식: `단가 × 저장 시간`
- 과금 단위: 저장 용량 기준으로, 사용 여부와 무관하게 비용 발생
- 주의사항: 인스턴스를 중지해도 과금됨. 단가는 디스크 종류에 따라 다름.

# SSH 를 사용한 접속과 키 페어: 공개키 암호 방식을 이용한 접근 관리

## SSH로 접속하기

- EC2 서버 관리는 일반적으로 SSH를 통해 수행한다.
- SSH 접속 시 키 페어 파일이 필요하며, 분실 시 서버 재생성이 필요하므로 주의
- 서버의 전반 작업(성능 조절, 백업 등)은 콘솔에서 가능하지만, 소프트웨어 조작은 SSH로 원격 접속하여 수행하는 것이 일반적
- 서버에는 SSH 데몬이 실행되어 있어야 하고, 클라이언트는 `Putty`, `Tera Term` 같은 SSH 프로그램을 이용
- 대부분의 OS에는 SSH 클라이언트가 기본 설치되어 있다.

## 키 페어란?

- 키 페어(Key Pair)는 로그인 인증에 사용하는 공개키와 비밀키 한 쌍
    - 공개키: `서버(인스턴스)`에 등록됨
    - 비밀키: `사용자(클라이언트)`가 소유하고 인증 시 사용
- AWS는 이 두 키를 하나의 키 페어 파일로 제공한다.
- SSH 접속 시
    - 인스턴스에는 공개키가 포함되고,
    - 클라이언트는 비밀키를 설정해 접속
- 키 페어는 생성 시에만 다운로드 가능하며, 분실 시에는 서버 재구축 필요
- 리전 간 공유는 불가능하지만, 같은 리전 내에서는 동일 키를 여러 인스턴스에 사용 가능하며 추가 비용 없음

# Elastic IP 주소: 고정 공인 IP 주소를 부여

## Elastic IP 주소란

- Elastic IP는 AWS가 제공하는 고정(public) IPv4 주소
- 일반 공인 IP는 인스턴스를 정지 후 재시작하면 IP가 바뀌지만 Elastic IP는 계정에 귀속되므로 인스턴스를 삭제해도 지속 사용 가능하
- 서버에서 IP가 바뀌면 문제가 생기므로, 고정 IP가 필요할 때 Elastic IP를 연결해 사용한다

## Elastic IP 주소의 확보와 부여

- Elastic IP 주소는 AWS 계정 단위로 연결됨 (인스턴스 단위 아님)
- 인스턴스를 삭제해도 해당 IP는 계정에서 계속 소유 가능하며 다른 인스턴스나 네트워크에 재부여 가능하다.
- 단, 이미 인스턴스에 할당된 공인 IP는 Elastic IP로 전환할 수 없으며 다시 풀로 반환된다.
- Elastic IP는 리전 단위로 관리되므로, 다른 리전에서는 사용할 수 없다.

## Elastic I P 주소의 요금

- 기본적으로 1개 IP는 무료, 추가 IP는 시간 단위 과금
- 사용하지 않고 분리된 상태이거나, 중지된 인스턴스나 네트워크에 연결된 경우에도 소액 요금이 발생한다.
- 따라서 사용하지 않는 Elastic IP는 해제하는 것이 좋다.

# Elastic Load Balancing: 트래픽을 분배하는 분산 장치

## ELB란?

- ELB (Elastic Load Balancing)는 AWS에서 제공하는 로드 밸런서이다
- 서버에 집중되는 트래픽(접속 요청)을 여러 서버나 네트워크에 분산시켜 처리한다
- 한 서버에 부하가 몰리는 것을 방지하므로, 부하 분산 장치라고도 한다.
- 결과적으로 트래픽이 균등하게 분산되어 안정적인 서비스 제공이 가능해진다

<img width="493" alt="image" src="https://github.com/user-attachments/assets/7a13053f-977b-4872-bdf1-556001732865" />


## ELB의 종류

### ALB (Application Load Balancer)

- HTTP/HTTPS에 적합
- OSI 7계층(애플리케이션 계층)에서 동작
- 요청의 URL 디렉터리 기반 분배 가능
- 인스턴스와 암호화된 통신 가능
- 단점: 고정 IP로 외부 호스트 전송 불가

> 지원 프로토콜: HTTP, HTTPS
> 

### NLB (Network Load Balancer)

- TCP 통신에 적합
- OSI 4계층(전송 계층)에서 동작
- ALB처럼 상세한 분배는 어려움
- 정적 IP 설정 가능,  클라이언트 IP를 서버로 전달 가능

> 지원 프로토콜: TCP, TLS
> 

### CLB (Classic Load Balancer)

- 구형 ELB, 다양한 프로토콜 지원이 장점
- 현재는 ALB, NLB로 대체되는 추세
- 신규 시스템에는 비권장

> 지원 프로토콜: TCP, SSL/TLS, HTTP, HTTPS
> 

# 스냅샷 : 서버 데이터 백업

## 스냅샷이란?

- 특정 시점의 서버 디스크 상태(파일, 폴더, OS, 설정 등)를 통째로 저장한 백업.
- 활용 목적
    - 소프트웨어/OS 변경 전 문제 발생 시 복구 용도
    - 개인 사용자도 AMI 생성 목적으로 자주 사용
- EBS 스냅샷 특징
    - 최초 1회는 전체 백업, 이후에는 변경된 데이터만 저장하는 증분 백업 방식
    - 증분 방식은 저장 비용 절감을 위함
    - 스냅샷을 삭제하면 해당 스냅샷 고유 데이터만 삭제되며, 변경되지 않은 고유 데이터는 다음 스냅샷에 흡수되어 보존

## EBS 스냅샷을 생성하는 방법

- 관리 콘솔에서 볼륨 단위(스토리지 전체)를 선택해 스냅샷 생성
- 생성된 스냅샷으로 EBS 볼륨을 생성하면, 원본 볼륨의 복제본이 됨
- AMI를 만들 때도 스냅샷을 활용
- Amazon DLM(Data Lifecycle Manager)를 사용하면 스냅샷 생성 및 삭제를 자동화할 수 있음
- 스냅샷은 정기적으로 생성해 서버 장애에 대비할 수 있음
- 요금은 생성된 스냅샷 용량(GB 단위) 기준으로 부과

### cf) 스냅샷의 보존 장소

- 스냅샷은 Amazon S3에 저장되지만, 일반 S3처럼 사용자가 직접 접근하거나 다운로드할 수 없음
- S3 요금은 별도로 부과되지 않음

# 오토 스케일링 : 수요에 맞춰 EC2 대수를 증감

## 오토 스케일링이란

- 서버의 접속 상태(액세스)에 따라 자동으로 서버 수를 늘리거나 줄이는 기능
- EC2를 포함한 다양한 AWS 서비스에서 사용 가능
- 작동 방식:
    - EC2 Auto Scaling 단독 사용 가능
    - 또는 CloudWatch의 모니터링 데이터(CPU 부하, 네트워크 트래픽 등)를 기반으로 자동 스케일링 수행
- 효과
    - 트래픽이 많아지면 서버 수 증가
    - 트래픽이 줄면 서버 수 감소
        
        → 비용 절감 + 성능 유지
        

<img width="408" alt="image" src="https://github.com/user-attachments/assets/ae01df44-e809-444f-b4c5-fddb020c2479" />


## 감시와 인스턴스 수의 결정

- 오토 스케일링을 사용하려면 Auto Scaling 그룹을 생성하고 인스턴스의 최소/최대 수를 설정해야 함
    - 이 범위 내에서 인스턴스 수가 자동으로 증감
- Auto Scaling 그룹에는 서버 시작에 필요한 AMI, 키 페어, 보안 그룹 등을 미리 설정해야 함
- 오토 스케일링 자체는 무료, 단, CloudWatch를 이용한 모니터링에는 요금이 발생

### 인스턴스 수 증가 방식 (3가지)

1. EC2 인스턴스가 정지되면 새 인스턴스를 자동 생성
2. 스케줄 기반으로 사전에 설정된 시간에 맞춰 증감
3. CPU/네트워크 부하가 임계치를 넘을 때 자동 증감
