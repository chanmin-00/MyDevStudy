> 개략적인 규모 추정은 보편적으로 통용되는 성능 수치상에서 사고 실험을 행하여 추정치를 계산하는 행위로서, 어떤 설계가 요구사항에 부합할 것인지 보기 위한 것이다.
> 

# 2의 제곱 수

분산 시스템에서 다루는 데이터 양에 대한 제대로 된 계산 결과를 얻으려면 데이터 볼륨의 단위를 2의 제곱수로 표현하면 어떻게 되는지를 우선 알아야 한다.

최소 단위는 1바이트, 8비트로 구성된다. 아스키 문자 하나가 차지하는 메모리 크기가 1바이트다.

흔히 쓰이는 데이터 볼륨 단위

| 2의 제곱 | 근사치 | 이름 | 축약형 |
| --- | --- | --- | --- |
| 2¹⁰ | 1천 (thousand) | 1킬로바이트 (Kilobyte) | 1KB |
| 2²⁰ | 1백만 (million) | 1메가바이트 (Megabyte) | 1MB |
| 2³⁰ | 10억 (billion) | 1기가바이트 (Gigabyte) | 1GB |
| 2⁴⁰ | 1조 (trillion) | 1테라바이트 (Terabyte) | 1TB |
| 2⁵⁰ | 1000조 (quadrillion) | 1페타바이트 (Petabyte) | 1PB |

# 모든 프로그래머가 알아야 하는 응답지연 값

| 연산명 | 시간 |
| --- | --- |
| L1 캐시 참조 | 0.5ns |
| 분기 예측 오류 (branch mispredict) | 5ns |
| L2 캐시 참조 | 7ns |
| 뮤텍스(mutex) 락/언락 | 100ns |
| 주 메모리 참조 | 100ns |
| Zippy로 1KB 압축 | 10,000ns = 10µs |
| 1 Gbps 네트워크로 2KB 전송 | 20,000ns = 20µs |
| 메모리에서 1MB 순차적으로 read | 250,000ns = 250µs |
| 같은 데이터 센터 내에서의 메시지 왕복 지연시간 | 500,000ns = 500µs |
| 디스크 탐색(seek) | 10,000,000ns = 10ms |
| 네트워크에서 1MB 순차적으로 read | 10,000,000ns = 10ms |
| 디스크에서 1MB 순차적으로 read | 30,000,000ns = 30ms |
| 한 패킷이 CA(캘리포니아)로부터 네덜란드까지 왕복 지연시간 | 150,000,000ns = 150ms |

이 수치를 보면 다음과 같은 사실을 알 수 있다.

- 메모리는 빠르지만 디스크는 아직도 느리다.
- 디스크 탐색 (seek) 은 가능한 한 피하라.
- 단순한 압축 알고리즘은 빠르다.
- 데이터를 인터넷으로 전송하기 전에 가능하면 압축하라.
- 데이터 센터는 보통 여러 지역 (region) 에 분산되어 있고 , 센터들 간에 데이터를 주고받는 데는 시간이 걸린다.

# 가용성에 관계된 수치들

고가용성은 시스템이 오랜 시간 동안 지속적으로 중단 없이 운영될 수 있는 능력을 지칭하는 용어이다. 대부분의 서비스는 99%에서 100% 사이의 값을 갖는다.

가용시간은 관습적으로 숫자 9를 사용해 표시한다. 9가 많을 수록 좋은 것이다.

| 가용률 | 하루당 장애시간 | 주당 장애시간 | 개월당 장애시간 | 연간 장애시간 |
| --- | --- | --- | --- | --- |
| 99% | 14.40분 | 1.68시간 | 7.31시간 | 3.65일 |
| 99.9% | 1.44분 | 10.08분 | 43.83분 | 8.77시간 |
| 99.99% | 8.64초 | 1.01분 | 4.38분 | 52.60분 |
| 99.999% | 864.00밀리초 | 6.05초 | 26.30초 | 5.26분 |
| 99.9999% | 86.40밀리초 | 604.80밀리초 | 2.63초 | 31.56초 |

# 트위터 QPS와 저장소 요구량 측정

### 1. 가정

- 월간 능동 사용자: 3억 명
- 일간 사용자 비율: 50% → 일간 능동 사용자: 1.5억 명
- 사용자 1인당 트윗 수: 하루 2건
- 미디어 포함 비율: 10%
- 데이터 보관 기간: 5년

### 2. QPS(Query Per Second) 추정

- 하루 총 트윗 수: 1.5억 × 2 = 3억 트윗
- 평균 QPS: 3억 / (24시간 × 3600초) = 약 3500
- 최대 피크 QPS: 평균 QPS × 2 = 약 7000

### 3. 미디어 저장소 요구량

- 평균 트윗 크기: 트윗 ID 64바이트 + 텍스트 140바이트 + (미디어 1MB)
- 일일 미디어 저장량: 1.5억 × 2 × 10% × 1MB = 30TB
- 5년간 저장소 요구량: 30TB × 365일 × 5년 = 약 55PB

규모 추정 문제 관련하여 다음과 같은 팁을 활용하면 좋다.

- **근사치를 활용한 계산**
    - 복잡한 계산식은 간단한 수치로 근사하여 계산 속도를 높일 수 있다.
    - 예: 99987 ÷ 9.1 → 약 100,000 ÷ 10
- **가정 사항은 반드시 명시**
    - 문제 해결 과정에서 세운 가정은 따로 기록해두고 기준을 명확히 한다.
- **단위를 항상 표시**
    - 예: 5 → 5KB인지 5MB인지 불명확할 수 있으므로 단위를 명확히 기입한다.
- **자주 나오는 추정 항목 연습**
    - `QPS`, `최대 QPS`, `저장소 요구량`, `캐시 요구량`, `서버 수` 등은 자주 출제되므로 반복 연습이 필요하다.
- **절차가 핵심**
    - 정답 자체보다 문제를 해결해 나가는 방식, 가정 설정, 단위 정리, 논리 전개 과정이 더 중요하다.
