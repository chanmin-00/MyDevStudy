# 데이터베이스 커넥션을 매번 획득할 때의 문제

## 커넥션 획득 과정 (1회 연결 시)

1. 애플리케이션이 DB 드라이버를 통해 커넥션을 요청
2. DB 드라이버는 DB와 TCP/IP 연결을 생성 (3-way handshake 등 네트워크 동작 발생)
3. ID, PW 등 정보를 DB로 전달
4. DB는 인증을 거쳐 DB 세션 생성
5. 커넥션 생성 완료 후 클라이언트로 응답
6. DB 드라이버가 Connection 객체 생성 및 반환

이 과정은 시간도 오래 걸리고 리소스도 많이 소모된다.

- 커넥션 획득 시간은 DB마다 다르며, 빠르면 수 ms, 느리면 수십 ms 이상 걸린다
- 이 시간이 사용자 응답 속도에 영향을 미친다
- 특히 사용자가 많을수록 커넥션 생성 비용이 누적되며 서버와 DB 모두에 부담을 준다

# 커넥션 풀

- 커넥션 풀은 미리 생성된 커넥션을 재사용하도록 관리하는 구조
- 마치 수영장(pool)에 커넥션을 담아두고 필요할 때 꺼내 쓰는 방식

# 커넥션 풀의 동작 방식

## 커넥션 풀 초기화

- 애플리케이션 시작 시, 미리 커넥션을 여러 개(DB와 연결된 상태로) 생성한다.
- 기본적으로 10개 전후의 커넥션을 풀에 유지하며, 서비스 환경에 따라 조정 가능하다.

## 커넥션 획득

- 애플리케이션 로직에서 DB 드라이버를 통해 새로운 커넥션을 생성하는 게 아니라, 커넥션 풀에 요청하여 이미 만들어진 커넥션을 참조로 가져온다.
- 응답 속도가 매우 빠르고 리소스를 아낄 수 있다.

<img width="555" alt="image" src="https://github.com/user-attachments/assets/5187204c-d9b9-47fa-8ec3-79f7450166c3" />


<img width="554" alt="image" src="https://github.com/user-attachments/assets/55b9dc19-613f-4a90-b5fe-e3fcdef20380" />


## 커넥션 반환

- 커넥션 사용이 끝나면 close()로 종료하는 것이 아니라, 커넥션을 풀에 그대로 반환한다.
- 커넥션은 살아있는 상태로 다시 재사용 가능하다.

# 커넥션 풀 도입의 이점

- `속도 향상` : 커넥션 생성을 매번 하지 않기 때문에 빠른 응답을 제공한다.
- `리소스 절약` : 매번 TCP/IP, 인증, 세션 생성 과정 생략하기 때문에 리소스를 절약한다.
- `DB 보호` : 풀의 커넥션 수를 제한함으로써 DB에 무한정 연결되는 것을 방지한다.
- `안정성 증가` : 예측 가능한 커넥션 사용량으로 서버 안정성을 확보한다.

# 실무에서의 커넥션 풀 적용

- 커넥션 풀은 실무에서 반드시 사용하는 기본 기능이다.
- 직접 구현도 가능하지만, 오픈소스 라이브러리를 사용하는 것이 일반적이다.

## 주요 커넥션 풀 오픈소스

- `commons-dbcp2`
- `tomcat-jdbc`
- `HikariCP`

> 스프링 부트 2.0 이상에서는 별도 설정 없이도 기본으로 HikariCP를 사용
> 
> 
> 성능, 안전성, 설정 편의성이 뛰어나 실무에서 가장 널리 쓰인다
>
